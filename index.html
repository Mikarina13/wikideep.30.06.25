<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WikiDeep.io</title>
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="/style-responsive.css">
    <link rel="stylesheet" href="/carousel-navigation-removal.css">
    <link rel="stylesheet" href="/public/hide-forum-nav.css">
    <link rel="stylesheet" href="/public/filter-toggle-styles.css">
    <link rel="stylesheet" href="/public/nebula-view-styles.css">
    <script type="module" src="/main.jsx"></script>
    <script type="module" src="/src/footer-menu.js"></script>
    <script type="module" src="/carousel-fix.js"></script>
    <script type="module" src="/main.jsx-observer.js"></script>
    <script type="module" src="/remove-carousel-navigation.js"></script>
    <script type="module" src="/src/utils/pageIdentifier.js"></script>
  </head>
  <body>
    <div id="app"></div>
    
    <!-- Archive Search Results Container -->
    <div id="archive-results-container" class="archive-results-container">
      <div class="search-results-header">
        <h2>Archive Search Results</h2>
        <button id="close-search" class="close-search-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      
      <!-- View Toggle Buttons -->
      <div class="view-toggle-container">
        <button class="view-toggle-btn active" data-view="list">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="8" y1="6" x2="21" y2="6"></line>
            <line x1="8" y1="12" x2="21" y2="12"></line>
            <line x1="8" y1="18" x2="21" y2="18"></line>
            <line x1="3" y1="6" x2="3.01" y2="6"></line>
            <line x1="3" y1="12" x2="3.01" y2="12"></line>
            <line x1="3" y1="18" x2="3.01" y2="18"></line>
          </svg>
          List View
        </button>
        <button class="view-toggle-btn" data-view="nebula">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <circle cx="12" cy="12" r="4"></circle>
            <line x1="4.93" y1="4.93" x2="9.17" y2="9.17"></line>
            <line x1="14.83" y1="14.83" x2="19.07" y2="19.07"></line>
            <line x1="14.83" y1="9.17" x2="19.07" y2="4.93"></line>
            <line x1="4.93" y1="19.07" x2="9.17" y2="14.83"></line>
          </svg>
          Nebula View
        </button>
      </div>
      
      <div id="search-results" class="search-results">
        <p class="empty-state">Enter a search term to find archive posts</p>
      </div>
      <div id="nebula-view-container" class="nebula-view-container" style="display: none;">
        <!-- Nebula view will be rendered here -->
      </div>
      <div id="search-loading" class="search-loading" style="display: none;">
        <p>Searching...</p>
      </div>
    </div>
    
    <div class="footer">
      <div class="footer-links">
        <a href="/forum.html">Forum</a>
        <a href="/info-hub.html">Contributor Guidelines</a>
        <a href="/info-hub.html#terms">Terms</a>
        <a href="/info-hub.html#privacy-policy">Privacy Policy</a>
        <a href="/info-hub.html#copyright-notice">Copyright Notice</a>
        <a href="/contact.html">Contact Us</a>
        <a href="/support.html">Support WikiDeep.io</a>
        <a href="/our-vision.html">Our Vision</a>
        <a href="https://www.youtube.com/watch?v=ZBG0qnbsdrI" target="_blank" rel="noopener noreferrer">Intro Video</a>
      </div>
    </div>
    <div class="left-edge-trigger"></div>
    <div class="menu-hamburger-indicator">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </div>
    
    <style>
      /* Additional mobile improvements for main page */
      @media (max-width: 768px) {
        #app {
          padding: 80px 10px 20px 10px;
        }
        
        .search-results {
          max-height: 60vh;
          overflow-y: auto;
        }
      }
      
      /* View toggle styles for search results */
      .view-toggle-container {
        margin: 15px auto;
      }
      
      /* Archive results container enhancements */
      .archive-results-container {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 90%;
        max-width: 1200px;
        height: 80vh;
        background: white;
        border-radius: 12px;
        box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }
      
      .search-results {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
      }
      
      .nebula-view-container {
        flex: 1;
        overflow: hidden;
      }
      
      .close-search-btn {
        position: absolute;
        top: 15px;
        right: 15px;
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        z-index: 10;
      }
      
      .close-search-btn:hover svg {
        stroke: #fac637;
      }
    </style>
    
    <script type="module">
      import SearchResultsView from './src/utils/searchResultsView.js';
      
      // Initialize home page search results view when the DOM is loaded
      document.addEventListener('DOMContentLoaded', () => {
        // Set up view toggle for search results
        setupSearchResultsView();
      });
      
      function setupSearchResultsView() {
        const resultsContainer = document.getElementById('archive-results-container');
        if (!resultsContainer) return;
        
        // Set up listeners for view toggle buttons
        const listViewBtn = document.querySelector('.view-toggle-btn[data-view="list"]');
        const nebulaViewBtn = document.querySelector('.view-toggle-btn[data-view="nebula"]');
        const searchResults = document.getElementById('search-results');
        const nebulaContainer = document.getElementById('nebula-view-container');
        
        if (listViewBtn && nebulaViewBtn && searchResults && nebulaContainer) {
          // Create the view manager when search results are shown
          let searchResultsView = null;
          
          // Listen for when search results are populated
          const observer = new MutationObserver(mutations => {
            mutations.forEach(mutation => {
              if (mutation.type === 'childList' && 
                  !searchResults.querySelector('.empty-state') && 
                  !searchResultsView) {
                
                // Initialize view manager with current results
                searchResultsView = new SearchResultsView('#archive-results-container', {
                  listViewSelector: '#search-results',
                  nebulaContainerId: 'nebula-view-container',
                  listToggleSelector: '.view-toggle-btn[data-view="list"]',
                  nebulaToggleSelector: '.view-toggle-btn[data-view="nebula"]',
                  // We'll get the results data from the view
                });
                
                // Get the results data
                const resultItems = searchResults.querySelectorAll('.result-item');
                if (resultItems.length > 0) {
                  const resultsData = Array.from(resultItems).map(item => {
                    return {
                      id: item.dataset.id,
                      title: item.querySelector('.result-title')?.textContent || 'Untitled',
                      type: 'archive',
                      created_at: new Date().toISOString() // Fallback
                    };
                  });
                  
                  // Update the view with the data
                  searchResultsView.updateResults(resultsData);
                }
              }
            });
          });
          
          observer.observe(searchResults, { childList: true });
          
          // Manual handling for the view toggle buttons
          listViewBtn.addEventListener('click', () => {
            listViewBtn.classList.add('active');
            nebulaViewBtn.classList.remove('active');
            searchResults.style.display = 'block';
            nebulaContainer.style.display = 'none';
          });
          
          nebulaViewBtn.addEventListener('click', () => {
            nebulaViewBtn.classList.add('active');
            listViewBtn.classList.remove('active');
            searchResults.style.display = 'none';
            nebulaContainer.style.display = 'block';
            
            // Initialize nebula view if not already initialized
            if (searchResultsView) {
              searchResultsView.switchToNebulaView();
            }
          });
        }
      }
    </script>
  </body>
</html>